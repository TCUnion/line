<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LINE Rich Menu 管理工具</title>
  <meta name="description" content="LINE Messaging API Rich Menu 視覺化管理介面">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="app">
    <!-- 頂部導航 -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" />
            <line x1="3" y1="9" x2="21" y2="9" />
            <line x1="9" y1="9" x2="9" y2="21" />
          </svg>
          <h1>Rich Menu Manager</h1>
        </div>
      </div>
      <div class="header-right">
        <div id="tokenStatus" class="token-status disconnected">
          <span class="status-dot"></span>
          <span class="status-text">未連線</span>
        </div>
        <button id="btnSetToken" class="btn btn-ghost" title="設定 Token">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </button>
      </div>
    </header>

    <!-- 主要內容 -->
    <main class="main">
      <!-- 側邊選單 -->
      <nav class="sidebar">
        <button class="nav-item active" data-section="menus">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" />
            <line x1="3" y1="9" x2="21" y2="9" />
            <line x1="9" y1="9" x2="9" y2="21" />
          </svg>
          <span>選單管理</span>
        </button>
        <button class="nav-item" data-section="create">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="16" />
            <line x1="8" y1="12" x2="16" y2="12" />
          </svg>
          <span>建立選單</span>
        </button>
        <button class="nav-item" data-section="users">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
          </svg>
          <span>使用者綁定</span>
        </button>
        <button class="nav-item" data-section="aliases">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
          </svg>
          <span>別名管理</span>
        </button>
      </nav>

      <!-- 內容區域 -->
      <div class="content">
        <!-- 選單管理 -->
        <section id="section-menus" class="section active">
          <div class="section-header">
            <h2>選單管理</h2>
            <div class="section-actions">
              <button id="btnRefresh" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 4 23 10 17 10" />
                  <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                </svg>
                重新整理
              </button>
            </div>
          </div>
          <div id="menuList" class="menu-grid">
            <div class="empty-state">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                opacity="0.4">
                <rect x="3" y="3" width="18" height="18" rx="2" />
                <line x1="3" y1="9" x2="21" y2="9" />
              </svg>
              <p>尚未載入選單資料</p>
              <p class="empty-hint">請先設定 Channel Access Token</p>
            </div>
          </div>
        </section>

        <!-- 建立選單 -->
        <section id="section-create" class="section">
          <div class="section-header">
            <h2>建立選單</h2>
          </div>
          <div class="create-options">
            <h3>選擇模板</h3>
            <div id="templateList" class="template-grid"></div>
            <div class="divider">
              <span>或</span>
            </div>
            <h3>自訂 JSON</h3>
            <div class="json-editor">
              <textarea id="jsonEditor" rows="20"
                placeholder='貼上 Rich Menu JSON...&#10;&#10;{&#10;  "size": { "width": 2500, "height": 1686 },&#10;  "selected": true,&#10;  "name": "我的選單",&#10;  "chatBarText": "點擊開啟",&#10;  "areas": [...]&#10;}'></textarea>
              <div class="json-actions">
                <button id="btnValidate" class="btn btn-secondary">驗證 JSON</button>
                <button id="btnCreateFromJson" class="btn btn-primary">建立選單</button>
              </div>
            </div>
          </div>
        </section>

        <!-- 使用者綁定 -->
        <section id="section-users" class="section">
          <div class="section-header">
            <h2>使用者綁定</h2>
          </div>
          <div class="form-card">
            <div class="form-group">
              <label for="userId">使用者 ID</label>
              <input type="text" id="userId" placeholder="U 開頭的 33 碼字串（例：Uxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx）">
            </div>
            <div class="form-group">
              <label for="userRichMenuSelect">選擇 Rich Menu</label>
              <select id="userRichMenuSelect">
                <option value="">-- 請先載入選單 --</option>
              </select>
            </div>
            <div class="form-actions">
              <button id="btnLinkUser" class="btn btn-primary">綁定選單</button>
              <button id="btnUnlinkUser" class="btn btn-danger">解除綁定</button>
              <button id="btnQueryUser" class="btn btn-secondary">查詢綁定</button>
            </div>
            <div id="userResult" class="result-box" style="display:none"></div>
          </div>
          <div class="form-card" style="margin-top:1.5rem">
            <h3>預設選單管理</h3>
            <div id="defaultMenuInfo" class="info-box">載入中...</div>
            <div class="form-actions" style="margin-top:1rem">
              <select id="defaultRichMenuSelect">
                <option value="">-- 請先載入選單 --</option>
              </select>
              <button id="btnSetDefault" class="btn btn-primary">設為預設</button>
              <button id="btnCancelDefault" class="btn btn-danger">取消預設</button>
            </div>
          </div>
        </section>

        <!-- 別名管理 -->
        <section id="section-aliases" class="section">
          <div class="section-header">
            <h2>別名管理</h2>
            <p class="section-desc">別名可搭配 richmenuswitch action 實現多層選單換頁功能</p>
          </div>
          <div class="form-card">
            <h3>建立新別名</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="aliasId">別名 ID</label>
                <input type="text" id="aliasId" placeholder="例：richmenu-alias-page-a">
              </div>
              <div class="form-group">
                <label for="aliasRichMenuSelect">對應 Rich Menu</label>
                <select id="aliasRichMenuSelect">
                  <option value="">-- 請先載入選單 --</option>
                </select>
              </div>
              <button id="btnCreateAlias" class="btn btn-primary" style="align-self:flex-end">建立</button>
            </div>
          </div>
          <div class="form-card" style="margin-top:1.5rem">
            <h3>現有別名</h3>
            <div id="aliasList" class="alias-list">
              <p class="empty-hint">尚未載入...</p>
            </div>
          </div>
        </section>
      </div>
  </div>

  <!-- Token 設定對話框 -->
  <div id="tokenModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>設定 Channel Access Token</h3>
        <button class="modal-close" id="btnCloseModal">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-desc">
          從 <a href="https://developers.line.biz/console/" target="_blank" rel="noopener">LINE Developers Console</a>
          取得你的 Channel Access Token。
        </p>
        <div class="form-group">
          <label for="tokenInput">Channel Access Token</label>
          <input type="password" id="tokenInput" placeholder="貼上你的 Token...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelToken">取消</button>
        <button class="btn btn-primary" id="btnSaveToken">儲存</button>
      </div>
    </div>
  </div>

  <!-- 圖片上傳對話框 -->
  <div id="uploadModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>上傳選單圖片</h3>
        <button class="modal-close" id="btnCloseUpload">&times;</button>
      </div>
      <div class="modal-body">
        <p id="uploadMenuName" class="modal-desc"></p>
        <div class="upload-area" id="uploadArea">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
            opacity="0.4">
            <rect x="3" y="3" width="18" height="18" rx="2" />
            <circle cx="8.5" cy="8.5" r="1.5" />
            <polyline points="21 15 16 10 5 21" />
          </svg>
          <p>拖拉圖片到此處，或點擊選擇</p>
          <p class="upload-hint">支援 PNG / JPEG，上限 1MB</p>
          <input type="file" id="imageInput" accept="image/png,image/jpeg" hidden>
        </div>
        <div id="imagePreview" class="image-preview" style="display:none">
          <img id="previewImg" alt="預覽">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelUpload">取消</button>
        <button class="btn btn-primary" id="btnConfirmUpload" disabled>上傳</button>
      </div>
    </div>
  </div>

  <!-- JSON 查看對話框 -->
  <div id="jsonViewModal" class="modal">
    <div class="modal-content modal-wide">
      <div class="modal-header">
        <h3 id="jsonViewTitle">選單 JSON</h3>
        <button class="modal-close" id="btnCloseJsonView">&times;</button>
      </div>
      <div class="modal-body">
        <div class="json-view-toolbar">
          <button id="btnCopyJson" class="btn btn-sm btn-secondary">📋 複製 JSON</button>
          <span id="jsonViewMeta" class="json-view-meta"></span>
        </div>
        <pre id="jsonViewContent" class="json-view-pre"><code></code></pre>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCloseJsonView2">關閉</button>
      </div>
    </div>
  </div>

  <!-- 複製編輯器對話框 -->
  <div id="cloneEditorModal" class="modal">
    <div class="modal-content modal-editor">
      <div class="modal-header">
        <h3 id="cloneEditorTitle">複製選單</h3>
        <button class="modal-close" id="btnCloseCloneEditor">&times;</button>
      </div>
      <div class="modal-body" style="max-height:80vh;overflow-y:auto">
        <!-- 預覽區 -->
        <div id="clonePreviewContainer" class="preview-container">
          <img id="clonePreviewImg" alt="Rich Menu" class="preview-image">
          <div id="clonePreviewOverlay" class="preview-overlay"></div>
        </div>

        <!-- 基本設定 -->
        <div class="clone-settings">
          <h4>📝 基本設定</h4>
          <div class="form-row">
            <div class="form-group">
              <label for="cloneName">名稱</label>
              <input type="text" id="cloneName">
            </div>
            <div class="form-group">
              <label for="cloneChatBar">聊天列文字</label>
              <input type="text" id="cloneChatBar">
            </div>
          </div>
        </div>

        <!-- 區域編輯列表 -->
        <div class="clone-areas-header">
          <h4>🎯 點擊區域</h4>
          <span id="cloneAreasCount" class="json-view-meta"></span>
        </div>
        <div id="cloneAreasList" class="clone-areas-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCloseCloneEditor2">取消</button>
        <button class="btn btn-primary" id="btnSubmitClone">🚀 建立選單</button>
      </div>
    </div>
  </div>

  <!-- 選單預覽對話框 -->
  <div id="previewModal" class="modal">
    <div class="modal-content modal-preview">
      <div class="modal-header">
        <h3 id="previewTitle">選單預覽</h3>
        <button class="modal-close" id="btnClosePreview">&times;</button>
      </div>
      <div class="modal-body">
        <p id="previewMeta" class="modal-desc"></p>
        <div class="preview-legend">
          <span class="legend-item"><span class="legend-color"
              style="background:rgba(6,199,85,0.5)"></span>message</span>
          <span class="legend-item"><span class="legend-color" style="background:rgba(59,130,246,0.5)"></span>uri</span>
          <span class="legend-item"><span class="legend-color"
              style="background:rgba(245,158,11,0.5)"></span>postback</span>
          <span class="legend-item"><span class="legend-color"
              style="background:rgba(168,85,247,0.5)"></span>richmenuswitch</span>
          <span class="legend-item"><span class="legend-color" style="background:rgba(107,114,128,0.5)"></span>其他</span>
        </div>
        <div id="previewContainer" class="preview-container">
          <img id="previewMenuImg" alt="Rich Menu 圖片" class="preview-image">
          <div id="previewOverlay" class="preview-overlay"></div>
        </div>
        <!-- 點擊區域後顯示的詳細資訊 -->
        <div id="areaDetail" class="area-detail" style="display:none">
          <div class="area-detail-header">
            <h4 id="areaDetailTitle"></h4>
            <button class="btn btn-sm btn-ghost"
              onclick="document.getElementById('areaDetail').style.display='none'">✕</button>
          </div>
          <div id="areaDetailBody" class="area-detail-body"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnClosePreview2">關閉</button>
      </div>
    </div>
  </div>

  <!-- Toast 通知 -->
  <div id="toastContainer" class="toast-container"></div>
  </div>

  <script src="app.js"></script>
</body>

</html>